/*!
sarine.viewer.dynamic.light.sprite - v0.1.0 -  Sunday, August 7th, 2016, 3:56:19 PM 
 The source code, name, and look and feel of the software are Copyright Â© 2015 Sarine Technologies Ltd. All Rights Reserved. You may not duplicate, copy, reuse, sell or otherwise exploit any portion of the code, content or visual design elements without express written permission from Sarine Technologies Ltd. The terms and conditions of the sarine.com website (http://sarine.com/terms-and-conditions/) apply to the access and use of this software.
 */
(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=function(){function a(b){console.log(""),this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),this.src=b.src,this.element=b.element,this.autoPlay=b.autoPlay,this.callbackPic=b.callbackPic,this.id=this.element[0].id,this.element=this.convertElement(),Object.getOwnPropertyNames(a.prototype).forEach(function(a){return"Error"===this[a].name?console.error(this.id,a,"Must be implement",this):void 0},this),this.element.data("class",this),this.element.on("play",function(a){return $(a.target).data("class").play.apply($(a.target).data("class"),[!0])}),this.element.on("stop",function(a){return $(a.target).data("class").stop.apply($(a.target).data("class"),[!0])}),this.element.on("cancel",function(a){return $(a.target).data("class").cancel().apply($(a.target).data("class"),[!0])})}var b,c;return c=ResourceManager.getInstance(),b=function(){return console.error(this.id,"must be implement")},a.prototype.first_init=Error,a.prototype.full_init=Error,a.prototype.play=Error,a.prototype.stop=Error,a.prototype.convertElement=Error,a.prototype.cancel=function(){return c.cancel(this)},a.prototype.loadImage=function(a){return c.loadImage.apply(this,[a])},a.prototype.setTimeout=function(a,b){return c.setTimeout.apply(this,[this.delay,b])},a}(),this.Viewer=b,b.Dynamic=function(a){function c(a){c.__super__.constructor.call(this,a),this.delay=50,Object.getOwnPropertyNames(b.Dynamic.prototype).forEach(function(a){return"Error"===this[a].name?console.error(this.id,a,"Must be implement",this):void 0},this)}return d(c,a),c.playing=!1,c.prototype.nextImage=Error,c.prototype.play=function(a,b){var c;return a&&(this.playing=!0),this.nextImage.apply(this),this.playing?(c=this,this.setTimeout(this.delay,c.play)):void 0},c.prototype.stop=function(){return this.playing=!1},c}(b),a=function(a){function b(a){var c,d;for(b.__super__.constructor.call(this,a),this.sliceDownload=a.sliceDownload,this.jsonFileName=a.jsonFileName,this.firstImagePath=a.firstImagePath,this.spritesPath=a.spritesPath,this.oneSprite=a.oneSprite,this.imageType=a.imageType,this.isSprite=!1,this.imageType=this.imageType||".png",this.metadata=void 0,this.sprites=[],this.currentSprite=0,this.playing=!1,this.delta=1,this.imageIndex=-1,this.imagesDownload=0,this.imagegap=0,this.playOrder={},this.isAvailble=!0,this.sliceDownload=3|this.sliceDownload,this.imagesArr={},this.downloadImagesArr={},this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),c=d=0;f>=0?f>=d:d>=f;c=f>=0?++d:--d)this.imagesArr[c]=void 0}var c,e,f,g,h,i,j,k,l,m,n;return d(b,a),f=48,i=0,e={},j={},h={},k=!0,l=100,n=100,m=0,g=1,c=function(){function a(a,b){this.column=a.width/b,this.rows=a.height/b,this.image=a,this.totalImage=this.column*this.rows}return a}(),b.prototype.convertElement=function(){return this.canvas=$("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this.element.append(this.canvas)},b.prototype.first_init=function(){var a,b;return a=this.first_init_defer,b=this,this.loadImage(this.src+this.firstImagePath).then(function(c){return-1===c.src.indexOf("data:image")&&-1===c.src.indexOf("no_stone")||(b.isAvailble=!1,b.canvas.attr({"class":"no_stone"})),b.canvas.attr({width:c.width,height:c.height}),b.ctx.drawImage(c,0,0),a.resolve(b)}),a},b.prototype.full_init=function(){var a,b;return a=this.full_init_defer,b=this,$.getJSON(this.src+this.jsonFileName,function(a){return a.FPS||(a.FPS=15),b.metadata=a,b.canvas.attr({width:a.ImageSize,height:a.ImageSize}),""!==a.background&&b.canvas.parent().css("background","#"+a.background),b.delay=1e3/a.FPS,b.playing?b.play():void 0}).then(function(){return b.isSprite=!0,b.downloadSprite(a).then(function(){return b.autoPlay&&b.play(!0),!0})}).fail(function(c){return function(){return b.isSprite=!1,b.isAvailble?b.loadParts().then(a.resolve):a.resolve}}(this)),a},b.prototype.downloadSprite=function(a){var b;return b=this,this.loadImage(this.src+this.spritesPath+(this.oneSprite?"":this.sprites.length)+this.imageType).then(function(d){var e;return e=new c(d,b.metadata.ImageSize),b.imagesDownload+=e.column*e.rows,b.sprites.push(e),b.imagesDownload>=b.metadata.TotalImageCount?a.resolve(b):b.downloadSprite(a),!0})},b.prototype.loadParts=function(a,b){var c,d,e;return a=a||0,b=b||$.Deferred(),c=[],e=this,$.when.apply($,function(){var b,f,g,h;for(g=function(){var b,c,e,f;for(e=Object.getOwnPropertyNames(this.imagesArr),f=[],b=0,c=e.length;c>b;b++)d=e[b],(d+a)%this.sliceDownload===0&&f.push(d);return f}.call(this),h=[],b=0,f=g.length;f>b;b++)d=g[b],h.push(function(a){return e.loadImage(e.src+(10>a?"0"+a:a)+".png").then(function(a){return c.push(a)})}(d));return h}.call(this)).then(function(){var d,g,i,k;for(g=function(a){var b;return b=parseInt(a.src.match(/\d+(?=.png)/)[0]),h[b]=j[b]=a},i=0,k=c.length;k>i;i++)d=c[i],g(d);return Object.getOwnPropertyNames(j).length===f+1?b.resolve(e):e.loadParts(++a,b),e.delay=e.sliceDownload/a*l}),b},b.prototype.nextImage=function(){var a,b,c,d,e,f;if(this.isSprite){if(this.delta=1,this.metadata&&this.sprites.length>0)return this.imageIndex+this.delta!==this.metadata.TotalImageCount?this.imageIndex+=this.delta:this.oneSprite?this.imageIndex=0:this.imageIndex+=this.delta,e=this.sprites[this.currentSprite],(this.imageIndex-this.imagegap)%e.totalImage===0&&this.imageIndex>0&&(e=this.sprites.length-1===this.currentSprite?this.sprites[--this.currentSprite]:this.sprites[++this.currentSprite],this.imagegap=this.imageIndex),b=this.imageIndex-this.imagegap,a=parseInt(-1*parseInt(b%e.column)*this.metadata.ImageSize),f=parseInt(-1*parseInt(b/e.rows)*this.metadata.ImageSize),this.playOrder[this.imageIndex]||(this.playOrder[this.imageIndex]={spriteNumber:this.currentSprite,col:a,row:f}),c=this.playOrder[this.imageIndex],".png"===this.imageType&&this.ctx.clearRect(0,0,this.metadata.ImageSize,this.metadata.ImageSize),this.ctx.drawImage(this.sprites[c.spriteNumber].image,c.col,c.row)}else if(d=Object.getOwnPropertyNames(h).map(function(a){return parseInt(a)}),d.length>1)return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(h[d[g]],0,0),g=(g+1)%d.length},b}(b.Dynamic),this.LightSprite=a}).call(this);
//# sourceMappingURL=sarine.viewer.dynamic.light.sprite.bundle.min.js.map