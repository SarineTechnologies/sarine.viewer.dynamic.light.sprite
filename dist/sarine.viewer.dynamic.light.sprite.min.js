/*!
sarine.viewer.dynamic.light.sprite - v0.1.0 -  Thursday, August 4th, 2016, 4:49:32 PM 
 The source code, name, and look and feel of the software are Copyright Â© 2015 Sarine Technologies Ltd. All Rights Reserved. You may not duplicate, copy, reuse, sell or otherwise exploit any portion of the code, content or visual design elements without express written permission from Sarine Technologies Ltd. The terms and conditions of the sarine.com website (http://sarine.com/terms-and-conditions/) apply to the access and use of this software.
 */
(function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a){var c,d;for(b.__super__.constructor.call(this,a),this.sliceDownload=a.sliceDownload,this.jsonFileName=a.jsonFileName,this.firstImagePath=a.firstImagePath,this.spritesPath=a.spritesPath,this.oneSprite=a.oneSprite,this.imageType=a.imageType,this.imageType=this.imageType||".png",this.metadata=void 0,this.sprites=[],this.currentSprite=0,this.playing=!1,this.delta=1,this.imageIndex=-1,this.imagesDownload=0,this.imagegap=0,this.playOrder={},this.isAvailble=!0,this.sliceDownload=3|this.sliceDownload,this.imagesArr={},this.downloadImagesArr={},this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),c=d=0;f>=0?f>=d:d>=f;c=f>=0?++d:--d)this.imagesArr[c]=void 0}var d,e,f,g,h,i,j,k,l,m,n,o;return c(b,a),l=!1,f=48,i=0,e={},j={},h={},k=!0,m=100,o=100,n=0,g=1,d=function(){function a(a,b){this.column=a.width/b,this.rows=a.height/b,this.image=a,this.totalImage=this.column*this.rows}return a}(),b.prototype.convertElement=function(){return this.canvas=$("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this.element.append(this.canvas)},b.prototype.first_init=function(){var a,b;return a=this.first_init_defer,b=this,$.getJSON(this.src+this.jsonFileName,function(a){return a.FPS||(a.FPS=15),b.metadata=a,b.canvas.attr({width:a.ImageSize,height:a.ImageSize}),""!==a.background&&b.canvas.parent().css("background","#"+a.background),b.delay=1e3/a.FPS,b.playing?b.play():void 0}).then(function(){return l=!0,b.first_init_sprite()}).fail(function(a){return function(){return l=!1,b.first_init_images()}}(this)),a},b.prototype.full_init=function(){return l?this.full_init_sprite():this.full_init_images()},b.prototype.first_init_images=function(){var a,b;return a=this.first_init_defer,a.notify(this.id+" : start load first image"),b=this,this.loadImage(this.src+"00.png").then(function(c){return-1===c.src.indexOf("data:image")&&-1===c.src.indexOf("no_stone")||(b.isAvailble=!1,b.canvas.attr({"class":"no_stone"})),b.canvas.attr({width:c.width,height:c.height}),b.ctx.drawImage(c,0,0),a.resolve(b)}),a},b.prototype.first_init_sprite=function(){var a,b;return a=this.first_init_defer,b=this,b.loadImage(b.src+b.firstImagePath).then(function(c){return b.ctx.drawImage(c,0,0,b.metadata.ImageSize,b.metadata.ImageSize),b.imageIndex=0,a.resolve(b)}),a},b.prototype.full_init_images=function(){var a;return a=this.full_init_defer,this.isAvailble?this.loadParts().then(a.resolve):a.resolve,a},b.prototype.full_init_sprite=function(){var a,b;return a=this.full_init_defer,b=this,this.downloadSprite(a).then(function(){return b.autoPlay&&b.play(!0),!0}),a},b.prototype.downloadSprite=function(a){var b;return b=this,this.loadImage(this.src+this.spritesPath+(this.oneSprite?"":this.sprites.length)+this.imageType).then(function(c){var e;return e=new d(c,b.metadata.ImageSize),b.imagesDownload+=e.column*e.rows,b.sprites.push(e),b.imagesDownload>=b.metadata.TotalImageCount?a.resolve(b):b.downloadSprite(a),!0})},b.prototype.nextImage=function(){var a,b,c,d,e,f;return this.metadata&&this.sprites.length>0?(this.imageIndex+this.delta!==this.metadata.TotalImageCount&&this.imageIndex+this.delta!==this.imagesDownload||(this.delta=-1),this.imageIndex+this.delta===-1&&(this.delta=1),this.imageIndex+=this.delta,d=this.sprites[this.currentSprite],(this.imageIndex-this.imagegap)%d.totalImage===0&&this.imageIndex>0&&(1===this.delta?d=this.sprites[++this.currentSprite]:-1===this.delta&&(d=this.sprites[--this.currentSprite]),this.imagegap=this.imageIndex),this.backOnEnd||1!==this.sprites.length?b=this.imageIndex-this.imagegap+(-1===this.delta?this.sprites[this.currentSprite].totalImage:0):(f=this.sprites[this.currentSprite].totalImage-1,b=this.imageIndex-this.imagegap+(-1===this.delta?f:0)),a=parseInt(-1*parseInt(b%d.column)*this.metadata.ImageSize),e=parseInt(-1*parseInt(b/d.rows)*this.metadata.ImageSize),this.playOrder[this.imageIndex]||(this.playOrder[this.imageIndex]={spriteNumber:this.currentSprite,col:a,row:e}),c=this.playOrder[this.imageIndex],".png"===this.imageType&&this.ctx.clearRect(0,0,this.metadata.ImageSize,this.metadata.ImageSize),this.ctx.drawImage(this.sprites[c.spriteNumber].image,c.col,c.row)):void 0},b.prototype.loadParts=function(a,b){var c,d,e;return a=a||0,b=b||$.Deferred(),c=[],e=this,$.when.apply($,function(){var b,f,g,h;for(g=function(){var b,c,e,f;for(e=Object.getOwnPropertyNames(this.imagesArr),f=[],b=0,c=e.length;c>b;b++)d=e[b],(d+a)%this.sliceDownload===0&&f.push(d);return f}.call(this),h=[],b=0,f=g.length;f>b;b++)d=g[b],h.push(function(a){return e.loadImage(e.src+(10>a?"0"+a:a)+".png").then(function(a){return c.push(a)})}(d));return h}.call(this)).then(function(){var d,g,i,k;for(g=function(a){var b;return b=parseInt(a.src.match(/\d+(?=.png)/)[0]),h[b]=j[b]=a},i=0,k=c.length;k>i;i++)d=c[i],g(d);return Object.getOwnPropertyNames(j).length===f+1?b.resolve(e):e.loadParts(++a,b),e.delay=e.sliceDownload/a*m}),b},b.prototype.nextImage=function(){var a;return a=Object.getOwnPropertyNames(h).map(function(a){return parseInt(a)}),a.length>1?(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(h[a[g]],0,0),g=(g+1)%a.length):void 0},b}(Viewer.Dynamic),this.LightSprite=a}).call(this);
//# sourceMappingURL=sarine.viewer.dynamic.light.sprite.min.js.map